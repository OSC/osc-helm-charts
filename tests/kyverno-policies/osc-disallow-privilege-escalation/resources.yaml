---
apiVersion: v1
kind: Pod
metadata:
  name: test-pass-mariadb
  namespace: webservice
  labels:
    app.kubernetes.io/name: mariadb
    osc.edu/service-account: test
spec:
  containers:
    - name: mariadb
      image: mariadb:latest
      securityContext:
        runAsUser: 1001
        runAsGroup: 0
        allowPrivilegeEscalation: false
  initContainers:
    - name: db-permissions
      image: busybox
      securityContext:
        runAsUser: 65534
        allowPrivilegeEscalation: true
---
apiVersion: v1
kind: Pod
metadata:
  name: test-fail-mariadb
  namespace: webservice
  labels:
    app.kubernetes.io/name: mariadb
    osc.edu/service-account: test
spec:
  containers:
    - name: mariadb
      image: mariadb:latest
      securityContext:
        runAsUser: 1001
        runAsGroup: 0
        allowPrivilegeEscalation: true
  initContainers:
    - name: db-permissions
      image: busybox
      securityContext:
        runAsUser: 65534
        allowPrivilegeEscalation: true
---
apiVersion: v1
kind: Pod
metadata:
  name: test-fail2-mariadb
  namespace: webservice
  labels:
    app.kubernetes.io/name: mariadb
    osc.edu/service-account: test
spec:
  containers:
    - name: mariadb
      image: mariadb:latest
      securityContext:
        runAsUser: 1001
        runAsGroup: 0
        allowPrivilegeEscalation: false
  initContainers:
    - name: init
      image: busybox
      securityContext:
        runAsUser: 65534
        allowPrivilegeEscalation: true
---
apiVersion: v1
kind: Pod
metadata:
  name: test-fail3-mariadb
  namespace: webservice
  labels:
    app.kubernetes.io/name: mariadb
    osc.edu/service-account: test
spec:
  containers:
    - name: mariadb
      image: mariadb:latest
      securityContext:
        runAsUser: 1001
        runAsGroup: 0
        allowPrivilegeEscalation: false
  initContainers:
    - name: db-permissions
      image: busybox
      securityContext:
        runAsUser: 0
        allowPrivilegeEscalation: true
---
apiVersion: v1
kind: Pod
metadata:
  name: test-skip
  namespace: webservice
  labels:
    app.kubernetes.io/name: phylogatr
    osc.edu/service-account: test
spec:
  containers:
    - name: mariadb
      image: mariadb:latest
      securityContext:
        runAsUser: 1001
        runAsGroup: 0
        allowPrivilegeEscalation: true
  initContainers:
    - name: db-permissions
      image: busybox
      securityContext:
        runAsUser: 65534
        allowPrivilegeEscalation: true
